%% Tolkflip Backend - Erlang/OTP Implementation
%% High-performance, massively concurrent microservices
%% Optimized for millions of concurrent users

{erl_opts, [
    debug_info,
    warnings_as_errors,
    {parse_transform, lager_transform},
    {i, "apps"}
]}.

{deps, [
    %% HTTP Server & WebSocket
    {cowboy, "2.10.0"},
    {jsx, "3.1.0"},                    % JSON encoding/decoding

    %% Database Drivers
    {erlcass, "5.0.1"},                % Cassandra driver
    {eredis, "1.7.1"},                 % Redis client
    {poolboy, "1.5.2"},                % Connection pooling

    %% Authentication
    {jwerl, "1.2.0"},                  % JWT

    %% Logging
    {lager, "3.9.2"},

    %% Utilities
    {uuid, "2.0.6", {pkg, uuid_erl}},  % UUID generation
    {base64url, "1.0.1"}               % Base64 URL encoding
]}.

{relx, [
    {release, {tolkflip, "1.0.0"}, [
        sasl,
        tolkflip_shared,
        auth_service,
        chat_service,
        user_service,
        translation_service,
        transcription_service,
        media_service,
        presence_service,
        message_store_service,
        notification_service,
        webrtc_service,
        group_service,
        api_gateway
    ]},

    {dev_mode, true},
    {include_erts, false},

    {extended_start_script, true},

    {sys_config, "./config/sys.config"},
    {vm_args, "./config/vm.args"}
]}.

{profiles, [
    {prod, [
        {relx, [
            {dev_mode, false},
            {include_erts, true},
            {include_src, false}
        ]}
    ]},
    {test, [
        {deps, [
            {meck, "0.9.2"}
        ]}
    ]}
]}.

{project_plugins, [
    {rebar3_auto, "0.6.1"}
]}.

{shell, [
    {apps, [tolkflip_shared, auth_service, chat_service]}
]}.

{dialyzer, [
    {warnings, [unknown]}
]}.

{xref_checks, [
    undefined_function_calls,
    undefined_functions,
    locals_not_used,
    deprecated_function_calls,
    deprecated_functions
]}.

%% Cover for code coverage
{cover_enabled, true}.
{cover_opts, [verbose]}.
